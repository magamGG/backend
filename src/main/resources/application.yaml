# ============================================
# 공통 설정 (모든 프로파일에서 공통 사용)
# ============================================
spring:
  application:
    name: magamgg
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

  # 파일 업로드 설정
  servlet:
    multipart:
      max-file-size: 20MB
      max-request-size: 20MB

  # WebMvc 설정 (OAuth2ClientWebMvcSecurityConfiguration 에러 해결)
  web:
    resources:
      add-mappings: true
      static-locations: classpath:/static/

  # Redis 설정 (Valkey 호환)
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0

  # OAuth2 클라이언트 설정 (Google)
  # 주의: client-id와 client-secret이 빈 값이면 OAuth2ClientConfiguration 초기화 실패
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:dummy_google_client_id}
            client-secret: ${GOOGLE_CLIENT_SECRET:dummy_google_client_secret}
            scope:
              - email
              - profile
            redirect-uri: ${GOOGLE_REDIRECT_URI:http://localhost:8888/login/oauth2/code/google}
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v2/userinfo
            user-name-attribute: email

  # 캐싱 설정 - Redis
  cache:
    type: redis
    cache-names: leaveBalance, agencyInfo
    redis:
      time-to-live: 3600000  # 1시간 (밀리초)

# JWT 설정
jwt:
  access-secret: ${JWT_ACCESS_SECRET:dev-access-secret-key-12345678901234567890123456789012}
  refresh-secret: ${JWT_REFRESH_SECRET:dev-refresh-secret-key-98765432109876543210987654321098}
  access-expiration: 900000      # 15분 (밀리초)
  refresh-expiration: 604800000  # 7일 (밀리초)

# 파일 업로드 설정
file:
  upload-dir: uploads

# 공공데이터 API 설정
public-data:
  holiday:
    api-key: ${HOLIDAY_API_KEY:temporary_key_for_now}
    base-url: ${HOLIDAY_BASE_URL:http://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService}
    data-dir: holidays

# Notion OAuth 설정
notion:
  client-id: ${NOTION_CLIENT_ID:temporary_id}
  client-secret: ${NOTION_CLIENT_SECRET:temporary_secret}
  redirect-uri: ${NOTION_REDIRECT_URI:http://localhost:8888/auth/notion/callback}
  api-version: ${NOTION_API_VERSION:2022-06-28}

# 서버 설정
server:
  port: 8888
  servlet:
    encoding:
      charset: UTF-8
      enabled: true
      force: true

# Actuator 설정
management:
  endpoints:
    web:
      exposure:
        include: health,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: when-authorized
    env:
      enabled: false
    beans:
      enabled: false
    mappings:
      enabled: false
    configprops:
      enabled: false
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}

# 로깅 설정 (기본)
logging:
  level:
    org.hibernate.SQL: DEBUG
    org.hibernate.orm.jdbc.bind: TRACE
    com.kh.magamGG.global.security.JwtAuthenticationFilter: INFO
    com.kh.magamGG.domain.notification: INFO

---
# ============================================
# local 프로파일 (개발 환경)
# ============================================
spring:
  config:
    activate:
      on-profile: local

  # 데이터베이스 설정
  datasource:
    url: jdbc:mysql://localhost:3306/magamgg?serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    username: magam_user
    password: asdf1234!
    driver-class-name: com.mysql.cj.jdbc.Driver

  # JPA 설정
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        format_sql: true

  # 메일 설정
  mail:
    host: smtp.gmail.com
    port: 587
    username: ${MAIL_USERNAME:magamgglocalservice@gmail.com}
    password: ${MAIL_PASSWORD:gniy mzoy ewjw lqna}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connectiontimeout: 5000
          timeout: 5000
          writetimeout: 5000



# Google OAuth: GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET 환경변수로 설정 (시크릿 노출 방지)
google:
  oauth:
    client-id: ${GOOGLE_CLIENT_ID:}
    client-secret: ${GOOGLE_CLIENT_SECRET:}
    redirect-uri: ${GOOGLE_REDIRECT_URI:http://localhost:8888/api/auth/google/callback}
    scope: ${GOOGLE_SCOPE:openid profile email}

# Naver OAuth: NAVER_CLIENT_ID, NAVER_CLIENT_SECRET 환경변수로 설정 (시크릿 노출 방지)
naver:
  oauth:
    client-id: ${NAVER_CLIENT_ID:}
    client-secret: ${NAVER_CLIENT_SECRET:}
    redirect-uri: ${NAVER_REDIRECT_URI:http://localhost:8888/api/auth/naver/callback}
    # Naver API 엔드포인트
    authorization-url: https://nid.naver.com/oauth2.0/authorize
    token-url: https://nid.naver.com/oauth2.0/token
    user-info-url: https://openapi.naver.com/v1/nid/me

# Kakao OAuth: KAKAO_REST_API_KEY 환경변수로 설정 (시크릿 노출 방지)
# Kakao는 client-secret이 없고 REST API Key만 사용
kakao:
  oauth:
    rest-api-key: ${KAKAO_REST_API_KEY:}
    redirect-uri: ${KAKAO_REDIRECT_URI:http://localhost:8888/api/auth/kakao/callback}
    # Kakao API 엔드포인트
    authorization-url: https://kauth.kakao.com/oauth/authorize
    token-url: https://kauth.kakao.com/oauth/token
    user-info-url: https://kapi.kakao.com/v2/user/me